<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title></title>
    <link href="style.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Muli:400,100' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400' rel='stylesheet' type='text/css'>
</head>
<body>
  <div class='background'></div>
  <div class='all'>
    <h1>
      Rails migrations
      <a class='back' href='.'>Index</a>
    </h1>
    <h3>Automatically make migrations</h3>

<pre><code>$ rails generate migration RemovePartNumberFromProducts part_number:string
$ rails generate migration AddNameToWidgets name:string
</code></pre>

<h3>Run migrations</h3>

<pre><code>$ rake db:migrate
</code></pre>

<h3>Migrations</h3>

<pre><code>create_table :users do |t|
  t.string :name
  t.text   :description

  t.primary_key :id
  t.string      :title
  t.text        :description
  t.integer     :games_count
  t.float       :lol
  t.decimal     :price
  t.decimal     :price, :precision =&gt; 2, :scale =&gt; 10
  t.datetime    :expiration
  t.timestamp   :time_in
  t.time        :time_in
  t.date        :expiry
  t.binary      :image_data
  t.boolean     :is_admin
end

# Options:
  :null (boolean)
  :limit (integer)
  :default
</code></pre>

<h3>Operations</h3>

<pre><code>create_table
change_table
drop_table
add_column
change_column
rename_column
remove_column
add_index
remove_index
</code></pre>

<h3>Associations</h3>

<pre><code>t.references :category   # kinda same as t.integer :category_id

# Can have different types
t.references :category, polymorphic: true
</code></pre>

<h3>Add/remove columns</h3>

<pre><code>$ rails generate migration RemovePartNumberFromProducts part_number:string

class RemovePartNumberFromProducts &lt; ActiveRecord::Migration
  def up
    remove_column :products, :part_number
  end

  def down
    add_column :products, :part_number, :string
  end
end
</code></pre>

<h3>Indices</h3>

<pre><code># Simple
add_index :suppliers, :name

# Unique
add_index :accounts, [:branch_id, :party_id], :unique =&gt; true

# Named (:name =&gt; ...)
add_index :accounts, [:branch_id, :party_id], :unique =&gt; true, :name =&gt; &quot;by_branch_party&quot;

# Length
add_index :accounts, :name, :name =&gt; ‘by_name’, :length =&gt; 10
add_index :accounts, [:name, :surname], :name =&gt; ‘by_name_surname’,
  :length =&gt; {
    :name =&gt; 10,
    :surname =&gt; 15
  }

# Sort order (no MySQL support)
add_index :accounts, [:branch_id, :party_id, :surname],
  :order =&gt; {:branch_id =&gt; :desc, :part_id =&gt; :asc}
</code></pre>

<h3>References</h3>

<ul>
<li>http://apidock.com/rails/ActiveRecord/ConnectionAdapters/SchemaStatements/add_index</li>
</ul>

  </div>

  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/1.6.4/jquery.min.js'></script>
  <script src="http://cachedcommons.org/cache/prettify/1.0.0/javascripts/prettify-min.js"></script>
  <script>$("pre").addClass("prettyprint");</script>
  <script>prettyPrint();</script>
</body>
</html>
